### 函数是根基

javaScript是一门函数式语言(functional language)   

在JavaScript中，函数是第一型对象(first-class object)，可以将其视为其他任意类型的JavaScript对象

##### 函数是第一型对象

对象在JavaScript中有如下功能   

- 可以通过字面量进行创建
- 可以复制给变量、数组或其他对象的属性
- 可以作为参数传递给函数
- 可以作为函数的返回值进行返回
- 可以拥有动态创建并赋值的属性

JavaScript中，函数拥有全部这些功能，可以像这门语言的其他对象一样使用，因此，函数是第一型(first-class)对象

除了可以像其他对象类型一样使用外，函数还有一个特殊的功能，它们可以被调用(invoked).

这些调用，通常是以异步方式(asynchronous)进行调用。

#### 浏览器的事件轮询

图形用户界面(GUI)的桌面应用程序编程，大多数都是采用类似如下的方式

- 创建用户界面
- 进入轮询，等待事件触发
- 调用事件的处理程序(侦听器[listener])


我们的职责是为浏览器中发生的各种事件简历事件的处理程序(handler),这些事件在触发时被放置在一个事件队列(先进先出列表[FIFO])，然后浏览器将调用已经为这些事件建立好的处理程序(handler)

因为这些事件发生的事件和顺序都是不可预知的，所以事件处理函数的调用也是异步的

以下类型的事件都有可能互相穿插发生

- 浏览器事件，如当一个页面完成加载或卸载的时候
- 网络事件，如响应Ajax请求
- 用户事件，如鼠标单击、鼠标移动或者按键
- 计时器事件，如超时或计时器触发


浏览器的事件轮询是单线程(single-threaded)的，每个事件都是按照在队列中所放置的顺序来处理的，这就是所谓的FIFO(先进后出)列表，或者一个使用古老定时器的筒仓(silo).每个事件都在自己的生命周期内进行处理，所有其他事件必须等到这个时间处理结束以后才能继续处理，在任何情况下，单线程都不能同时执行两个处理程序。


#### 回调概念

定义一个函数，以便其他一些代码在适当的时机回头再调用它

举个栗子： function useless(callback){ return callback(); }

#### 使用比较器进行排序

Java和JavaScript都提供了一个简单的方式对数组进行升序排序  
Java代码

```java  
	
Integer[] values = { 213, 16, 2058, 54, 10, 1965, 57, 9};
Array.sort(values);
```

JavaScript版本代码

```JavaScript

var values = [213, 16, 2058, 54, 10, 1965, 57, 9 ];
values.sort();

```

为了能够对数据进行任意顺序的排序，这两种语言都给我们提供了一个比较算法，告诉该算法如何进行排序。我们没有让排序算法决定什么样的值应该排在前面还是后面，而是提供了一个函数进行排序比较，将排序算法作为回调传递给该函数，并在需要比较时进行调用，这一概念在这两种语言中都是相似的，但实现却大为不同。

在非函数式edjava中，方法不能存在于自身，而且不能作为参数传递给其他方法。而且，要排序的数据必须声明为可实例化对象的成员，然后再传递给排序方法。因此，Array.sort()方法有一个重载，接受一个包含比较方法的对象，该比较方法作为回调在数据比较时进行调用。该对象及其方法必须符合一个已知的格式(Java是强类型)，所以需要定义一个接口，在这种情况下，java库提供了如下接口(在一般情况下，我们可能需要定义自己的接口)

```java

public interface Comparator<T> {
	int compare(T t,T t1);
	boolean equals(Object o);
}

```

Java新手开发人员可以创建一个具体类实现该接口，做一次公平的比较，我们假设内行的Java开发人员可以使用匿名内联实现，使用Array.sort()静态方法，进行降序排序的代码，应该如下示例一样：

```java

Arrays.sort(values,new Comparator<Integer>{
	public int compare(Integer value1, Integer value2) {
		return value2 - value1;
	}
});

```

compare()方法是内联比较器(Comparator)的实现，如果传递值的顺序需要逆序的话，则期望返回一个负数；否则，就返回一个正数；如果相等则返回零，所以简单将两值相减即可返回期望的返回值，从而对数组进行降序排列   

当考虑用JavaScript的函数式特性实现相同功能的时候，Java的这种方法的冗长会变得更加明显

```javascript

var values = [ 213, 16, 2058, 54, 10, 1965, 57, 9];
values.sort(function(value1,value2){ return value2 - value1; });

```

JavaScript中的函数式特性 允许我们使用像其他类型一样，创建一的作为独立实体的函数，并将其作为一个参数，像传递其他类型一样将其传递给另外一个方法，而这个方法可以将该函数作为一个参数进行接收，就像接收其他类型的参数一样，这就是发挥作用的‘第一型’状态。

#### 函数声明

JavaScript函数是使用函数字面量(function literal) 进行声明从而创建函数值的，就像使用数字字面量创建数字值一样，记住，作为第一型对象，函数可以像其他值一样在语言中使用，比如字符串和数字。   

函数字面量由四个部分组成  
1. function 关键字
2. 可选名称，如果指定名称，则必须是一个有效的JavaScript标识符
3. 括号内部，一个以逗号分隔的参数列表，各个参数名称必须是有效的标识符，而且参数列表允许为空，即使是空参数列表，圆括号也必须始终存在。
4. 函数体，包含在大括号内的一系列JavaScript语句，函数体可以为空，单打括号必须始终存在

所有函数都有一个name属性，该属性保存的是该函数名称的字符串，没有名称的函数也仍有name属性，只是该属性值为空字符串罢了

#### 函数调用

有四种不同的方式可以进行函数调用，每种方式都有自己的细微差别 

- 作为一个函数进行调用，最简单的形式
- 作为一个方法进行调用，在对象上进行调用，支持面向对象编程
- 作为构造器进行调用，创建一个新对象
- 通过applay()或call()方法进行调用


##### 作为构造器进行调用

将函数作为构造器进行调用它并没有什么特别的地方，构造器函数的声明和其他函数声明一样，不同的地方是在于如何调用该函数。   

将函数作为构造器(constructor)进行调用，我们要在函数调用前使用new关键字

将函数作为构造器进行调用，是JavaScript的一个超级特性，因为构造器调用时，如下特殊行为就会发生。

- 创建一个新的空对象。
- 传递给构造器的对象是this参数，从而成为构造器的函数上下文
- 如果没有显示的返回值，新创建的对象则作为构造器的返回值返回  

构造器的目的是要创建一个新对象并对其进行设置，然后将其作为构造器的返回值返回，任何干扰这种意图的函数，都不适合作为构造器。

##### 构造器编码注意事项
	
构造器的目的是通过函数调用初始化创建新的对象，虽然这样的函数可以成为“正常”的函数，甚至可以赋值给对象属性以便作为方法调用，但通常这样做没有什么用处。

由于构造器的编码和使用方式不同于其他函数，除了作为构造器调用以外，通常它们也不是全部那么有用，命名约定的出现是为了区别构造器和其他普通函数和方法。

函数和方法的命名通常以动词开头，来描述它们所做的事情，并且以小写字母开头。而构造器的命名通常是由一个描述所构造对象的名词来描述，并且以大写字母开头。

#### 使用apply()和call()方法

在函数调用的时候，JavaScript为我们提供了一种可以显示指定任何一个对象作为其函数上下文。JavaScript的每个函数都有 apply()和call()方法，使用任何其中一个方法，我们都可以实现这种功能。

通过函数的apply()方法来调用函数，我们要给apply()传入两个参数：一个是作为函数上下文的对象，另一个是作为函数参数所组成的数组。call()方法的使用方式累次，唯一不同的是，给函数传入的参数是一个参数列表，而不是单个数组。

##### 在回调中强制指定函数上下文

在命令式编程中，通常是将数组传递给一个方法，并用for循环语句遍历每一个条目，然后再对每个条目进行执行操作

相比之下，函数式编程则是创建一个函数来执行单个元素，并将每个条目都传递给该函数。

两者之前的区别在与思维层面： 函数是程序的构建块而不是命令式语句.


### 总结

在本章中，了解函数在JavaScript中的各种优异的工作方式，函数的使用无处不在，深入理解其内部工作原理是编写高质量JavaScript代码的核心。

- 以函数式语言学习JavaScript，从而编写更复杂的代码
- 函数是第一型对象，就像是JavaScript中的其他任意对象一样，和其他任意对象类型一。
- 每个对象都有一个与众不同的小宇宙，函数的小宇宙是它可以被调用
- 函数是通过字面量进行创建的，其名字是可选的
- 在页面生命周期内，浏览器可以将函数作为各种类型的事件处理程序进行调用
- 函数的作用域与大多数其他语言的作用域不同
- 函数的形参列表和实际列表的长度可以是不同的
- 每个函数调用都会传入两个隐式参数，arguments，实际传入的参数集合，this，作为函数的上下文的对象引用
- 可以用不同的方法进行函数调用，不同的调用机制决定了函数上下文的不同